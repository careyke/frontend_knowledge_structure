# Base 性能优化实践

## 1. 背景



## 2. 优化方案&收益



### 2.1 网络层

#### 2.1.1 模板分块

##### 背景

目前 TTFB 花费的时间比较长（1000ms），这部分优化的 ROI 比较高。

##### 原因分析

模板服务中会请求基础配置信息和用户信息，还有页面首屏数据。目前是等待所有数据 ready 之后才开始返回 HTML 文件，导致 TTFB 耗时的时间比较长。

##### 实现原理

浏览器在解析 HTML 文件时并不是等待完整的HTML文件下载完成才开始解析，而是一个循序渐进的过程，拿到多少 HTML 片段就解析多少。

所以可以将整个 HTML 文件拆分成多个块返回。需要分析各个模板片段**对于后端数据的依赖关系和片段之间的依赖关系**

- 对于没有依赖的模板片段，可以放在 chunk1 中返回，减少 TTFB 的时间。
  - 开启 JS 资源的**预拉取**
  - 开启 CSS 资源的拉取

- 对于依赖配置数据&用户基础数据的模板片段可以放在 chunk2 中返回。
  - 真正引入 JS 资源
- 对于依赖页面首屏数据的片段，放在 chunk3 中返回。

Node 后端在构建HTML文件的时候，需要**并行请求**依赖的数据。

##### 异常兜底

浏览器**流式传输文件**这个特性对于一些低版本的浏览器并不支持，而且在网络波动的情况下，有可能chunk2或者chunk3迟迟没有返回，这个时候就需要做异常降级的处理。当命中异常时，降级加载 chunk 的模板。



### 2.2 渲染层

#### 2.2.1 SSR 优化

##### 背景




